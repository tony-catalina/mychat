$(document).ready(function(){
    "use strict";
$('#pagetour').modal();
$('#pagetour').on('hidden.bs.modal',function(e){
    $('body').removeClass('blureffect');
    $('#videocall').fadeOut(0);
    $('#videocall,.modal-backdrop,.model-bg').fadeOut();
    return!1
})
nicescroll();
$('.nav-content-bttn').on('click',function(){$('.nav-content ul li a').removeClass('active');
$(this).addClass('active');var data_tab=$(this).attr('data-tab');
$('.sidebar').removeClass('active');
$('#'+data_tab).addClass('active');return!1});
$('.night-mode').on('click',function(){$('body').toggleClass('dark');return!1});
$('.profile-detail-bttn').on('click',function(){$('.profile-content').addClass('active');return!1});
$('.close-icon').on('click',function(){$('.profile-content').removeClass('active');return!1});
/*$('.chat-list-item .avatar,.chat-list-item .chat-bttn').on('click',function(){
    alert("111")
    console.log($(this).find("h3").text())
    $('.chat-content').addClass('mobile-active');
    return!1});*/
$('.back-chat-div').on('click',function(){$('.chat-content').removeClass('mobile-active');return!1});
$('.slider-0').owlCarousel({loop:!1,margin:0,nav:!1,autoplay:!0,dots:!1,responsive:{0:{items:6},600:{items:6},1000:{items:6},1400:{items:3}}})
var owlslide_1=$('.slider-1')
owlslide_1.owlCarousel({loop:!1,margin:0,nav:!1,autoplay:!1,dots:!0,responsive:{0:{items:1},600:{items:1},1000:{items:1}}})
$('.start-tour,.next-tour').on('click',function(){owlslide_1.trigger('next.owl.carousel')});
$('.tour-close-btn').on('click',function(){
    $('body').removeClass('blureffect');
    $('#pagetour').removeClass('show').fadeOut();
    $('.modal-backdrop,.model-bg').fadeOut(500);
    return!1});
$('#videocall-bttn').on('click',function(){$('body').addClass('blureffect');
$('#videocall,.modal-backdrop,.model-bg').fadeIn();return!1});
$('#video-close').on('click',function(){$('body').removeClass('blureffect');
$('#videocall').fadeOut(0);$('#videocall,.modal-backdrop,.model-bg').fadeOut();return!1});
$('#addfriend-bttn').on('click',function(){$('body').addClass('blureffect');
$('#addfriend,.modal-backdrop,.model-bg').fadeIn();return!1});
$('#addfriend-close').on('click',function(){
    $('body').removeClass('blureffect');
    $('#addfriend').fadeOut(0);
    $('#addfriend,.modal-backdrop,.model-bg').fadeOut();
    return!1
});
/*用户列表查询功能*/
$("#user-home-list").on("keyup",function () {
    var searchKey=$(this).val();
    userList(searchKey)
});
/*通知列表查询功能*/
$("#notification-home-list").on("keyup",function () {
    var searchKey=$(this).val();
    notification(searchKey)
})

$("#sendFriendApply").click(function () {
    var friend_user_id=$("#friend_user_id").val();
    var apply_friend_name=$("#apply_friend_name").val();
    var apply_friend_message=$("#apply_friend_message").val();
    console.log("======"+apply_friend_name+"-------------"+apply_friend_message);
    if(friend_user_id!=null||friend_user_id!=undefined||friend_user_id!=""){
        alert(friend_user_id)
        $.ajax({
            url:"/forFriend/friendApply",
            type:"post",
            data:{
                "friend_user_id":friend_user_id,
                "apply_friend_name":apply_friend_name,
                "apply_friend_message":apply_friend_message
            },
            success:function (e) {
                if(e.code==0){
                    $("#addfriend-close").click();
                    Notiflix.Report.Success( '请求成功', ''+e.msg+'', '关闭' );
                }else {
                    Notiflix.Report.Failure( '请求失败', ''+e.msg+'', '关闭' );
                }

            }
        })
    }else {
        Notiflix.Report.Failure( '用户获取id失败', '获取你要添加好友的对象id时发生了错误.', '关闭' );
    }

});


/*$('body').addClass('blureffect');
$('#pagetour').addClass('show').fadeIn()*/
$('.modal-backdrop,.model-bg').fadeOut(500);
});

function nicescroll(){$(".chat-body,.chat-list-content,.scroll-profile").niceScroll({cursorcolor:"#eee",cursoropacitymin:0,cursoropacitymax:1,cursorwidth:"3px",cursorborder:"0px solid #fff",cursorborderradius:"5px",zindex:"auto",scrollspeed:60,mousescrollstep:40,touchbehavior:!1,hwacceleration:!0,boxzoom:!1,dblclickzoom:!0,gesturezoom:!0,grabcursorenabled:!0,autohidemode:!0,background:"",iframeautoresize:!0,cursorminheight:32,preservenativescrolling:!0,railoffset:!1,bouncescroll:!1,spacebarenabled:!0,disableoutline:!0,horizrailenabled:!0,railalign:"right",railvalign:"bottom",enabletranslate3d:!0,enablemousewheel:!0,enablekeyboard:!0,smoothscroll:!0,sensitiverail:!0,enablemouselockapi:!0,cursorfixedheight:!1,hidecursordelay:400,irectionlockdeadzone:6,nativeparentscrolling:!0,enablescrollonselection:!0,cursordragspeed:0.3,rtlmode:"auto",cursordragontouch:!1,oneaxismousemode:"auto",scriptpath:"",preventmultitouchscrolling:!0,disablemutationobserver:!1,})}

/*用户列表*/
function userList(searchKey) {
    var searchVal="";
    if(searchKey!=undefined){
        searchVal=searchKey;
    }
    //页面初始化加载所有用户
    $.ajax({
        url:'/userInfo/userInfoList',
        type:"post",
        data:{
            "searchKey":searchVal
        },
        success:function (result) {
            /*循环添加前先清空之前div中的人员信息*/
            $("#userList").empty();
            $.each(result.result,function (index,i) {
                var userListStr='<li class="chat-list-item user-home-list">'+
                    '<figure class="avatar user-online">'+
                    '<img src="chatfile/images/user-2.png" alt="image">'+
                    '</figure>'+
                    '<div class="list-body">'+
                    '<div class="chat-bttn">'+
                    '<h3 class="mb-1 mt-1" title="'+result.result[index].userId+'">'+result.result[index].userName+'</h3>'+
                    '<p>'+result.result[index].userAccount+'</p>'+
                    '</div>'+
                    '<div class="list-action mt-2 text-right">'+
                    '<a href="#" class="btn-plus dropdown-toggle" data-toggle="dropdown"><i class="ti-plus"></i></a>'+
                    '<div class="dropdown-menu dropdown-menu-right">'+
                    '<a href="#" class="dropdown-item addfriend-bttn" id="addfriend-bttn">添加好友</a>'+
                    '<a href="#" class="dropdown-item get-all-userinfo">查看信息</a>'+
                    '<div class="dropdown-divider"></div>'+
                    '<a href="#" class="dropdown-item text-danger">删除</a>'+
                    '</div>'+
                    '</div>'+
                    '</div>'+
                    '</li>'
                $("#userList").append(userListStr);
            })
           /* $('.user-home-list').on('click',function(){
                alert("111")
                console.log($(this).find("h3").text())
                $('.chat-content').addClass('mobile-active');
                return!1});*/
           /*添加好友选项点击事件*/
            $('.addfriend-bttn').on('click',function(){
                $('body').addClass('blureffect');
                $('#addfriend,.modal-backdrop,.model-bg').fadeIn();
                $("#friend_user_id").val($(this).parent().parent().parent().find("h3").attr("title"));
                $("#apply_friend_name").val($(this).parent().parent().parent().find("h3").text());
                $("#apply_friend_message").val("你好,交个朋友吧~");
                return!1
            });

            /*查看详细信息选项点击事件*/
            $(".get-all-userinfo").click(function () {
                $('.profile-content').addClass('active');
                $(this).parent().removeClass("show");
                var thisUserId=$(this).parent().parent().parent().find("h3").attr("title");
                $.ajax({
                    url:"/userInfo/getUserInfoById",
                    type:"post",
                    data:{
                        "userId":thisUserId
                    },
                    success:function (e) {
                        console.log("----"+JSON.stringify(e.result));
                        alert($("#hidden-userinfo-tab").find("h5").text())
                        $("#hidden-userinfo-tab").find("h5").text(e.result.userName);
                        $("#hidden-userinfo-tab").find(".user-account").text(e.result.userAccount);
                    }
                })
                return!1
            });
        }
    })
}



/*通知列表*/
function notification(searchKey) {
    var searchVal="";
    if(searchKey!=undefined){
        searchVal=searchKey;
    }
    $.ajax({
        url:"/forFriend/getFriendApplyById",
        type:"post",
        data:{
            "searchKey":searchVal
        },
        success:function (e) {
            console.log("==============="+JSON.stringify(e.result))
            $("#notificationList").empty();
            $.each(e.result,function (index,i) {
                var notificationStr='<li class="chat-list-item">'+
                    '<figure class="avatar user-online">'+
                    '<span class="avatar-title bg-secondary rounded-circle"><i class="ti-heart"></i></span>'+
                    '</figure>'+
                    '<div class="list-body">'+
                    '<div class="chat-bttn">'+
                    '<h3 class="mb-1 mt-1" title="'+e.result[index].friendapply_id+'">'+e.result[index].user_name+'</h3>'+
                    '<p>'+e.result[index].apply_remarks+'</p>'+
                    '</div>'+
                    '<div class="list-action mt-2 text-right">'+
                    '<small>'+e.result[index].applyTimeStr+'</small>'+
                    '<div class="dropdown">'+
                    '<a href="#" class="more dropdown-toggle" style="display: inline"data-toggle="dropdown"><i class="ti-more-alt"></i></a>'+
                    '<div class="dropdown-menu dropdown-menu-right">'+
                    '<a href="#" class="dropdown-item  agree-add-friend">同意添加</a>'+
                    '<div class="dropdown-divider"></div>'+
                    '<a href="#" class="dropdown-item text-danger refuse-add-friend">拒绝添加</a>'+
                    '</div>'+
                    '</div>'+
                    '</div>'+
                    '</div>'+
                    '</li>'
                $("#notificationList").append(notificationStr);
            })
            
            $(".agree-add-friend").click(function () {
                
            });

            $('.refuse-add-friend').on('click',function(){
                var thisApplyId=$(this).parent().parent().parent().parent().find("h3").attr("title");
                alert(thisApplyId)
                $.ajax({
                    url:"/forFriend/refuseFriendApply",
                    type:"post",
                    data:{
                        "friendApplyId":thisApplyId
                    },
                    success:function (e) {
                        if(e.code==0){
                            Notiflix.Report.Success( '拒绝成功', ''+e.msg+'', '关闭' );
                            notification();
                        }else {
                            Notiflix.Report.Failure( '拒绝失败', ''+e.msg+'', '关闭' );
                        }
                        
                    }
                })
                return!1
            });
            
        }
    })
}